import * as vscode from 'vscode';
import * as path from 'path';
import * as fs from 'fs';
export function activate(context) {
    const provider = vscode.languages.registerCompletionItemProvider({ scheme: 'file', language: 'html' }, {
        provideCompletionItems(document, position) {
            const linePrefix = document.lineAt(position).text.substr(0, position.character);
            const includeMatch = linePrefix.match(/<include\s+file="([^"]*)$/);
            if (includeMatch) {
                const currentPath = includeMatch[1];
                const workspaceFolders = vscode.workspace.workspaceFolders;
                if (!workspaceFolders) {
                    return [];
                }
                const completions = [];
                const rootPath = workspaceFolders[0].uri.fsPath;
                // Scan for HTML and SVG files
                const scanDirectory = (dir, basePath) => {
                    const files = fs.readdirSync(dir);
                    for (const file of files) {
                        const fullPath = path.join(dir, file);
                        const stat = fs.statSync(fullPath);
                        if (stat.isDirectory()) {
                            scanDirectory(fullPath, basePath);
                        }
                        else if (file.endsWith('.html') || file.endsWith('.svg')) {
                            const relativePath = path.relative(basePath, fullPath).replace(/\\/g, '/');
                            const completion = new vscode.CompletionItem(relativePath, vscode.CompletionItemKind.File);
                            completion.detail = `Include ${file}`;
                            completion.documentation = new vscode.MarkdownString(`Include the file: ${relativePath}`);
                            completions.push(completion);
                        }
                    }
                };
                scanDirectory(rootPath, rootPath);
                return completions;
            }
            return [];
        }
    }, '"' // trigger on quote
    );
    context.subscriptions.push(provider);
}
export function deactivate() { }
